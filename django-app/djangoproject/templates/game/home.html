{% extends 'base.html' %}

{% block title %}Home - Enchantext{% endblock %}

{% block content %}
<div class="card">
    <h1 style="display:flex; align-items:center; gap:10px;">
    <img src="https://img.icons8.com/nolan/64/books-1.png" alt="books" width="40" height="40">
    Cast Your Own Adventure
</h1>
    <p>Welcome to Enchantext - Get lost in the right story! Dive into interactive stories where your choices shape the narrative.</p>
    
    {% if level %}
        <p><small><strong>{{ level }}</strong></small></p>
    {% endif %}
</div>

<div class="card">
    <h2>Find Stories</h2>
    <form method="GET" action="{% url 'home' %}">
        <div class="grid grid-2">
            <div class="form-group">
                <label for="search">Search by title or description:</label>
                <input type="text" id="search" name="search" value="{{ search_query }}" placeholder="Enter keywords...">
            </div>
            <div class="form-group">
                <label for="tags">Filter by tags:</label>
                <input type="text" id="tags" name="tags" value="{{ tags_filter }}" placeholder="e.g., adventure, mystery">
            </div>
        </div>
        <button type="submit" class="btn">Search</button>
        <a href="{% url 'home' %}" class="btn btn-secondary">Clear</a>
    </form>
</div>


<div class="card">
    <h2>Published Stories</h2>
    
    {% if stories %}
        <div class="grid grid-2">
            {% for story in stories %}
                <div class="card" style="background: #f8f9fa;">
                    <h3>{{ story.title }}</h3>
                    <p>{{ story.description|truncatewords:30 }}</p>
                    
                    <!-- Level 13: Tags -->
                    {% if story.tags_list %}
                        <div style="margin: 0.5rem 0;">
                            {% for tag in story.tags_list %}
                                <span class="badge" style="background: #e3f2fd; color: #1976d2;">{{ tag }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                    

                 {% if story.avg_rating %}
                        <div style="margin: 0.5rem 0; display:flex; align-items:center; gap:10px;">
                            <img src="https://img.icons8.com/nolan/25/star.png" alt="star"/> {{ story.avg_rating|floatformat:1 }} / 5.0 ({{ story.rating_count }} ratings)
                        </div>
                    {% endif %}

                    
                    <div style="margin-top: 1rem;">
                        <a href="{% url 'story_detail' story.id %}" class="btn">View Details</a>
                        <a href="{% url 'play_story' story.id %}" class="btn btn-success">Play Now</a>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No stories found. {% if search_query or tags_filter %}Try different search terms.{% else %}Check back later!{% endif %}</p>
    {% endif %}
</div>

{% if user.is_authenticated and user.profile.is_author %}
    <div class="card" style="background: #e8f5e9;">
        <h3 style="display:flex; align-items:center; gap:10px;">
            <img src="https://img.icons8.com/nolan/30/pen.png" alt="pen"/> Author Dashboard</h3>
        <p>Ready to create your own adventure?</p>
        <a href="{% url 'create_story' %}" class="btn btn-success">Create New Story</a>
        <a href="{% url 'my_stories' %}" class="btn btn-secondary">Manage My Stories</a>
    </div>
{% endif %}

{% if not user.is_authenticated %}
    <div class="card" style="background: #fff3e0;">
        <h3 style="display:flex; align-items:center; gap:10px;">
            <img src="https://img.icons8.com/nolan/35/add-user-group-woman-man.png" alt="add-user-group-woman-man"/> Join the Community</h3>
        <p><strong>Register as an Author</strong> to create your own interactive stories!</p>
        <a href="{% url 'register' %}" class="btn">Register Now</a>
    </div>
{% endif %}
{% endblock %}
{% block extra_css %}
<style>
  /* Hero card */
  .card:first-of-type{
    background: linear-gradient(135deg, rgba(255,111,163,0.12) 0%, rgba(179,157,219,0.14) 100%);
    border: 1px solid rgba(255,255,255,0.65);
    box-shadow: 0 16px 45px rgba(30, 12, 40, 0.10);
  }

  .card:first-of-type h1{
    font-size: 2.2rem;
    letter-spacing: 0.2px;
  }

  /* Find Stories card */
  .card:nth-of-type(2){
    background: rgba(255,255,255,0.90);
    border: 1px solid rgba(255,255,255,0.60);
  }

  /* Published stories "inner" cards (the ones with inline background #f8f9fa) */
  .grid.grid-2 > .card[style*="background"]{
    background: rgba(255,255,255,0.82) !important;
    border: 1px solid rgba(255,255,255,0.65);
    box-shadow: 0 12px 30px rgba(30, 12, 40, 0.10);
    transition: transform 0.18s ease, box-shadow 0.18s ease;
  }

  .grid.grid-2 > .card[style*="background"]:hover{
    transform: translateY(-3px);
    box-shadow: 0 18px 38px rgba(30, 12, 40, 0.14);
  }

  /* Tags on story cards */
  .grid.grid-2 .badge{
    background: rgba(200,193,255,0.25) !important;
    color: #5A4B8A !important;
    border: 1px solid rgba(200,193,255,0.45);
    font-weight: 800;
  }

  /* Author dashboard + Join community cards: match theme (override inline bg) */
  .card[style*="background: #e8f5e9"],
  .card[style*="background: #fff3e0"]{
    background: rgba(255,255,255,0.88) !important;
    border: 1px solid rgba(255,255,255,0.65);
  }
</style>
{% endblock %}